/*!
 * @license MIT
 * @preserve
 *
 * Barq: client-side autocomplete
 * https://github.com/joaocunha/barq/
 *
 * @author JoÃ£o Cunha - joao@joaocunha.net - twitter.com/@joaocunha
 *
 * Thanks to all contributors, specially @bhappyz, @ghostavio, @kumailht and @gxx
 */
!function(e,t){"use strict";e.Barq=function(i,n){var s=this,r=n||{};s.baseField=i,s.options={enablePagination:r.enablePagination||!0,resultsPerPage:r.resultsPerPage||50,removeFirstOptionFromSearch:r.removeFirstOptionFromSearch||!0,useFirstOptionTextAsPlaceholder:r.useFirstOptionTextAsPlaceholder||!0,placeholderText:r.placeholderText||null,noResultsMessage:r.noResultsMessage||"No results found.",onload:r.onload||function(){},onchange:r.onchange||function(){}};var l={dropdownList:"barq-list",textInput:"barq-text-input",textInputWithList:"barq-input-text-expanded",hidden:"barq-hidden",visible:"barq-visible",activeItem:"barq-active-item",noResults:"barq-no-results",match:"barq-match"},a={TAB:9,ENTER:13,SHIFT:16,ESC:27,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CMD:91},o=0,c={addEventListener:function(e,t,i){e.addEventListener?e.addEventListener(t,i):e.attachEvent("on"+t,i)},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},removeClass:function(e,t){if(e.classList)e.classList.remove(t);else{var i=new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi");e.className=e.className.replace(i," ")}},getTextNode:function(e){return e&&(e.innerText||e.textContent||e.innerHTML)},isElementOnViewport:function(i){var n=i.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(e.innerHeight||t.documentElement.clientHeight)&&n.right<=(e.innerWidth||t.documentElement.clientWidth)},escapeString:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}};s.init=function(){return c.addClass(s.baseField,l.hidden),s.textInput=u(),s.list=v(),s.items=p(),f(s.items),x(),d(),s.options.onload.call(s),s};var u=function(){var e=t.createElement("input");if(e.setAttribute("class",l.textInput),e.setAttribute("autocapitalize","off"),e.setAttribute("autocomplete","off"),e.setAttribute("autocorrect","off"),e.setAttribute("spellcheck","false"),e.setAttribute("tabindex",s.baseField.tabIndex),s.baseField.setAttribute("tabindex","-1"),s.options.placeholderText)e.setAttribute("placeholder",s.options.placeholderText);else if(s.options.useFirstOptionTextAsPlaceholder){var i=c.getTextNode(s.baseField.options[0]);e.setAttribute("placeholder",i)}return s.baseField.insertAdjacentHTML("afterend",e.outerHTML),s.baseField.nextElementSibling},d=function(){var e=s.baseField.querySelector("[selected]");return e&&s.selectItem(e),e},p=function(){s.options.removeFirstOptionFromSearch&&s.baseField.removeChild(s.baseField.options[0]);var e=s.baseField.innerHTML,t=/<option(?:[^>]*?value="([^"]*?)"|)[^>]*?>(.*?)<\/option>\n?/gi,i='<li data-value="$1">$2</li>';return e=e.replace(t,i),e=e.replace(/<!--([^\[|(<!)].*)/g,"").replace(/\s{2,}/g,"").replace(/(\r?\n)/g,"")};s.showList=function(){s.repositionList(),c.addClass(s.list,l.visible),c.addClass(s.textInput,l.textInputWithList),s.list.firstChild.className!==l.noResults&&c.addClass(s.list.firstChild,l.activeItem)},s.hideList=function(){c.removeClass(s.list,l.visible),c.removeClass(s.textInput,l.textInputWithList)},s.selectItem=function(e){var t=c.getTextNode(e);s.textInput.value=t,s.text=t,s.hideList();var i=e.getAttribute("data-value")?e.getAttribute("data-value"):e.value;s.baseField.value=i,s.value=i,s.options.onchange.call(s)};var v=function(){var e=t.createElement("ul");return e.setAttribute("class",l.dropdownList),s.textInput.insertAdjacentHTML("afterend",e.outerHTML),s.textInput.nextElementSibling},f=function(e){s.list.innerHTML=e,s.currentItemsDOM=s.list.childNodes},m=function(e){s.list.innerHTML+=e,s.currentItemsDOM=s.list.childNodes};s.repositionList=function(){var e=Math.floor(s.textInput.offsetTop+parseInt(s.textInput.offsetHeight,10));s.list.style.top=e+"px",s.list.style.left=s.textInput.offsetLeft+"px",s.list.style.width=s.textInput.offsetWidth+"px"},s.search=function(e,t){var i=h(e);if(s.options.enablePagination){t=t||0;var n=s.options.resultsPerPage;t>=0&&(i=i.splice(t,n))}return i.length&&(i=i.join("")),e&&i.length&&(i=g(e,i)),0===t&&i.length?(f(i),c.addClass(s.list.firstChild,l.activeItem)):m(i),i};var h=function(e){var t=/<li[^<]*<\/li>/gi;return""!==e&&(e=c.escapeString(e),t=new RegExp("<li[^>]*>[^<]*"+e+"[^<]*</li>","gi")),s.items.match(t)||[]},g=function(e,t){e=c.escapeString(e);var i=new RegExp("(<li[^>]*>[^<]*)("+e+")([^<]*</li>)","gi"),n='$1<em class="'+l.match+'">$2</em>$3';return t.replace(i,n)},b=function(){var e='<li class="0">1</li>',t=e.replace("0",l.noResults).replace("1",s.options.noResultsMessage);f(t)};s.paginate=function(){var e=s.list.children,t=e.length-2;return 0>t?-1:c.isElementOnViewport(e[t])?(o++,o*s.options.resultsPerPage):void 0},s.getActiveListItem=function(){return s.list.querySelector("."+l.activeItem)};var I=function(e){var t=s.currentItemsDOM;if(!(t.length<=1)){var i,n=s.getActiveListItem();e===a.UP?n.previousElementSibling&&(i=n.previousElementSibling):n.nextElementSibling&&(i=n.nextElementSibling),i&&(c.removeClass(n,l.activeItem),c.addClass(i,l.activeItem),s.scrollListItemIntoView(i))}};s.scrollListItemIntoView=function(e){var t=e.offsetTop,i=e.offsetHeight,n=s.list.offsetHeight,r=s.list.scrollTop,l=r>=t,a=t>=r+n-i;l?s.list.scrollTop=t:a&&(s.list.scrollTop=t-n+i)};var x=function(){c.addEventListener(s.textInput,"keyup",function(t){t=t||e.event;var i=t.keyCode||t.which,n=!1;for(var r in a)if(i==a[r]){n=!0;break}if(!n){s.list.scrollTop=0,o=0;var l=s.search(this.value);return l.length<1&&(b(),s.currentItemsDOM=null),void s.showList()}if(i===a.ENTER){var c=s.getActiveListItem();return void(c&&s.selectItem(c))}return i===a.ESC?void s.hideList():void 0}),c.addEventListener(s.textInput,"keydown",function(t){t=t||e.event;var i=t.keyCode||t.which;(i===a.UP||i===a.DOWN)&&s.currentItemsDOM&&I(i)}),c.addEventListener(s.textInput,"focus",function(){var e=s.search(this.value);e.length<1&&(b(),s.currentItemsDOM=null),s.showList()}),c.addEventListener(s.textInput,"blur",function(){!s.preventBlurTrigger&&s.getActiveListItem()&&s.selectItem(s.getActiveListItem())}),c.addEventListener(s.list,"scroll",function(){var e=s.paginate();e>=0&&s.search(s.textInput.value,e)}),c.addEventListener(s.list,"mousedown",function(t){s.preventBlurTrigger=!0,e.setTimeout(function(){s.preventBlurTrigger=!1},1);var i=t.target.className===l.match?t.target.parentNode:t.target;i!==s.list&&i.className!==l.noResults&&s.selectItem(i)}),c.addEventListener(e,"resize",function(){s.repositionList()})}},function(){var i=t.querySelectorAll("[data-barq]");[].forEach.call(i,function(t){new e.Barq(t).init()})}()}(window,document);