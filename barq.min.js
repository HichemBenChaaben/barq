/*!
 * @license MIT
 * @preserve
 *
 * Barq: client-side autocomplete
 * https://github.com/joaocunha/barq/
 *
 * @author Jo√£o Cunha - joao@joaocunha.net - twitter.com/@joaocunha
 *
 * Thanks to all contributors, specially @bhappyz, @ghostavio, @kumailht and @gxx
 */
!function(t,e){"use strict";t.Barq=function(n,i){var s=this,r=i||{};s.baseField=n,s.options={enablePagination:r.enablePagination||!0,resultsPerPage:r.resultsPerPage||50,removeFirstOptionFromSearch:r.removeFirstOptionFromSearch||!0,useFirstOptionTextAsPlaceholder:r.useFirstOptionTextAsPlaceholder||!0,placeholderText:r.placeholderText||null,noResultsMessage:r.noResultsMessage||"No results found.",dataSource:r.dataSource||null,onload:r.onload||function(){},onchange:r.onchange||function(){}};var a={dropdownList:"barq-list",textInput:"barq-text-input",textInputWithList:"barq-input-text-expanded",hidden:"barq-hidden",visible:"barq-visible",activeItem:"barq-active-item",noResults:"barq-no-results",match:"barq-match"},l={TAB:9,ENTER:13,SHIFT:16,ESC:27,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CMD:91},o={E_OPTION_NOT_FOUND:"No <option> elements found.",E_BASE_FIELD_NOT_FOUND:"Missing <select> element on instantiation.",E_INVALID_DATA_SOURCE:"Invalid data source. Expected an array of objects, JSON style."},c=0,u={addEventListener:function(t,e,n){t.addEventListener?t.addEventListener(e,n):t.attachEvent("on"+e,n)},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},removeClass:function(t,e){if(t.classList)t.classList.remove(e);else{var n=new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(n," ")}},getTextNode:function(t){return t&&(t.innerText||t.textContent||t.innerHTML)},isElementOnViewport:function(n){var i=n.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(t.innerHeight||e.documentElement.clientHeight)&&i.right<=(t.innerWidth||e.documentElement.clientWidth)},escapeString:function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}};s.init=function(){try{"SELECT"===n.tagName.toUpperCase()}catch(t){throw new v(o.E_BASE_FIELD_NOT_FOUND)}return u.addClass(s.baseField,a.hidden),s.textInput=d(),s.list=m(),s.items=s.options.dataSource?h():f(),g(s.items),T(),p(),s.options.onload.call(s),s};var d=function(){var t=e.createElement("input");if(t.setAttribute("class",a.textInput),t.setAttribute("autocapitalize","off"),t.setAttribute("autocomplete","off"),t.setAttribute("autocorrect","off"),t.setAttribute("spellcheck","false"),t.setAttribute("tabindex",s.baseField.tabIndex),s.baseField.setAttribute("tabindex","-1"),s.options.placeholderText)t.setAttribute("placeholder",s.options.placeholderText);else if(s.options.useFirstOptionTextAsPlaceholder)try{var n=u.getTextNode(s.baseField.options[0]);t.setAttribute("placeholder",n)}catch(i){throw new v(o.E_OPTION_NOT_FOUND)}return s.baseField.insertAdjacentHTML("afterend",t.outerHTML),s.baseField.nextElementSibling},p=function(){var t=s.baseField.querySelector("[selected]");return t&&s.selectItem(t),t},v=function(t){this.message=t,this.name="BarqException"};v.prototype=new Error;var f=function(){if(s.options.removeFirstOptionFromSearch)try{s.baseField.removeChild(s.baseField.options[0])}catch(t){throw new v(o.E_OPTION_NOT_FOUND)}var e=s.baseField.innerHTML,n=/<option(?:[^>]*?value="([^"]*?)"|)[^>]*?>(.*?)<\/option>\n?/gi,i='<li data-value="$1">$2</li>';return e=e.replace(n,i),e=e.replace(/<!--([^\[|(<!)].*)/g,"").replace(/\s{2,}/g,"").replace(/(\r?\n)/g,"")},h=function(){var t=s.options.dataSource;try{}catch(e){throw new v(o.E_INVALID_DATA_SOURCE)}for(var n="",i=0;i<t.length;i++)n+='<li data-value="'+t[i].value+'">'+t[i].text+"</li>";return n};s.showList=function(){s.repositionList(),u.addClass(s.list,a.visible),u.addClass(s.textInput,a.textInputWithList),s.list.firstChild.className!==a.noResults&&u.addClass(s.list.firstChild,a.activeItem)},s.hideList=function(){u.removeClass(s.list,a.visible),u.removeClass(s.textInput,a.textInputWithList)},s.selectItem=function(t){var e=u.getTextNode(t);s.textInput.value=e,s.text=e,s.hideList();var n=t.getAttribute("data-value")?t.getAttribute("data-value"):t.value;s.baseField.value=n,s.value=n,s.options.onchange.call(s)};var m=function(){var t=e.createElement("ul");return t.setAttribute("class",a.dropdownList),s.textInput.insertAdjacentHTML("afterend",t.outerHTML),s.textInput.nextElementSibling},g=function(t){s.list.innerHTML=t,s.currentItemsDOM=s.list.childNodes},I=function(t){s.list.innerHTML+=t,s.currentItemsDOM=s.list.childNodes};s.repositionList=function(){var t=Math.floor(s.textInput.offsetTop+parseInt(s.textInput.offsetHeight,10));s.list.style.top=t+"px",s.list.style.left=s.textInput.offsetLeft+"px",s.list.style.width=s.textInput.offsetWidth+"px"},s.search=function(t,e){var n=b(t);if(s.options.enablePagination){e=e||0;var i=s.options.resultsPerPage;e>=0&&(n=n.splice(e,i))}return n.length&&(n=n.join("")),t&&n.length&&(n=E(t,n)),0===e&&n.length?(g(n),u.addClass(s.list.firstChild,a.activeItem)):I(n),n};var b=function(t){var e=/<li[^<]*<\/li>/gi;return""!==t&&(t=u.escapeString(t),e=new RegExp("<li[^>]*>[^<]*"+t+"[^<]*</li>","gi")),s.items.match(e)||[]},E=function(t,e){t=u.escapeString(t);var n=new RegExp("(<li[^>]*>[^<]*)("+t+")([^<]*</li>)","gi"),i='$1<em class="'+a.match+'">$2</em>$3';return e.replace(n,i)},x=function(){var t='<li class="0">1</li>',e=t.replace("0",a.noResults).replace("1",s.options.noResultsMessage);g(e)};s.paginate=function(){var t=s.list.children,e=t.length-2;return 0>e?-1:u.isElementOnViewport(t[e])?(c++,c*s.options.resultsPerPage):void 0},s.getActiveListItem=function(){return s.list.querySelector("."+a.activeItem)};var L=function(t){var e=s.currentItemsDOM;if(!(e.length<=1)){var n,i=s.getActiveListItem();t===l.UP?i.previousElementSibling&&(n=i.previousElementSibling):i.nextElementSibling&&(n=i.nextElementSibling),n&&(u.removeClass(i,a.activeItem),u.addClass(n,a.activeItem),s.scrollListItemIntoView(n))}};s.scrollListItemIntoView=function(t){var e=t.offsetTop,n=t.offsetHeight,i=s.list.offsetHeight,r=s.list.scrollTop,a=r>=e,l=e>=r+i-n;a?s.list.scrollTop=e:l&&(s.list.scrollTop=e-i+n)};var T=function(){u.addEventListener(s.textInput,"keyup",function(e){e=e||t.event;var n=e.keyCode||e.which,i=!1;for(var r in l)if(n===l[r]){i=!0;break}if(!i){s.list.scrollTop=0,c=0;var a=s.search(this.value);return a.length<1&&(x(),s.currentItemsDOM=null),void s.showList()}if(n===l.ENTER){var o=s.getActiveListItem();return void(o&&s.selectItem(o))}return n===l.ESC?void s.hideList():void 0}),u.addEventListener(s.textInput,"keydown",function(e){e=e||t.event;var n=e.keyCode||e.which;(n===l.UP||n===l.DOWN)&&s.currentItemsDOM&&L(n)}),u.addEventListener(s.textInput,"focus",function(){var t=s.search(this.value);t.length<1&&(x(),s.currentItemsDOM=null),s.showList()}),u.addEventListener(s.textInput,"blur",function(){!s.preventBlurTrigger&&s.getActiveListItem()&&s.selectItem(s.getActiveListItem())}),u.addEventListener(s.list,"scroll",function(){var t=s.paginate();t>=0&&s.search(s.textInput.value,t)}),u.addEventListener(s.list,"mousedown",function(e){s.preventBlurTrigger=!0,t.setTimeout(function(){s.preventBlurTrigger=!1},1);var n=e.target.className===a.match?e.target.parentNode:e.target;n!==s.list&&n.className!==a.noResults&&s.selectItem(n)}),u.addEventListener(t,"resize",function(){s.repositionList()})}},function(){var n=e.querySelectorAll("[data-barq]");[].forEach.call(n,function(e){new t.Barq(e).init()})}()}(window,document);